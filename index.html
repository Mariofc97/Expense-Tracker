<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.35.3/plotly.min.js"
      integrity="sha512-7H/XbvOmUsf6mawBvmmx9BsPt9ew2NTwQ3QDSzNe6iyacDbCJU+7pBbZY1NdmTpuj7snxSsXasMYMiR2tv906g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <link href="./assets/fontawesome/css/fontawesome.css" rel="stylesheet" />
    <link href="./assets/fontawesome/css/brands.css" rel="stylesheet" />
    <link href="./assets/fontawesome/css/solid.css" rel="stylesheet" />
    <link rel="stylesheet" href="./styles/main.css" />
    <link rel="stylesheet" href="./styles/dashboard.css" />
  </head>
  <style>
    body {
background-color: #f9f9f9;
}

.expense-item {
background: white;
border-radius: 12px;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.icon-box {
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
font-size: 20px;
border-radius: 50%;
color: white;
}

.shopping {
background-color: #FFC107;
}

.food {
background-color: #FF7043;
}

.subscription {
background-color: #7E57C2;
}

.transportation {
background-color: #03A9F4;
}

</style>
  <body>
    <div id="expenseChart" style="width: 100%; height: 300px;"></div>
    <main class="py-5 px-5">
      <div class="container"></div>
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Recent Transactions</h2>
        <a href="create-expense.html" class="text-primary">See All</a>
    </div>

    <div id="expenseList"></div>
    </main>

   

  <script>
document.addEventListener("DOMContentLoaded", () => {
    const expenses = JSON.parse(localStorage.getItem("expenses")) || [];

    if (expenses.length === 0) {
      document.getElementById("expenseChart").innerHTML = "<p class='text-muted'>No expenses to display.</p>";
      return;
    }


    const expenseData = {};
    expenses.forEach(expense => {
      const date = new Date(expense.date).toISOString().split("T")[0]; 
      expenseData[date] = (expenseData[date] || 0) + parseFloat(expense.amount);
    });


    const dates = Object.keys(expenseData).sort(); 
    const amounts = dates.map(date => expenseData[date]);


    const trace = {
      x: dates,
      y: amounts,
      type: "scatter",
      mode: "lines",
      line: { 
        shape: "spline", 
        color: "#7E57C2", 
        width: 3 
      },
      fill: "tozeroy", 
    };

    const layout = {
      autosize: true, 
      paper_bgcolor: "rgba(0,0,0,0)",
      plot_bgcolor: "rgba(0,0,0,0)",
    };

    const config = { responsive: true };

    Plotly.newPlot("expenseChart", [trace], layout, config);

    window.onresize = () => Plotly.relayout("expenseChart", { width: window.innerWidth * 0.9 });
  });
      document.addEventListener("DOMContentLoaded", () => {
          const expenseListContainer = document.getElementById("expenseList");
          const expenses = JSON.parse(localStorage.getItem("expenses")) || [];

          if (expenses.length === 0) {
              expenseListContainer.innerHTML = "<p class='text-muted'>No expenses recorded.</p>";
              return;
          }

          expenses.forEach(expense => {
              const expenseItem = document.createElement("div");
              expenseItem.classList.add("expense-item", "d-flex", "justify-content-between", "align-items-center", "p-3", "mb-3");

              expenseItem.innerHTML = `
                  <div class="d-flex align-items-center">
                      <div class="icon-box ${expense.category.toLowerCase()}">
                          ${getCategoryIcon(expense.category)}
                      </div>
                      <div class="ms-3">
                          <h6 class="mb-1">${capitalizeFirstLetter(expense.category)}</h6>
                          <p class="text-muted small">${expense.description}</p>
                      </div>
                  </div>
                  <div class="text-end">
                      <h6 class="text-danger">- $${expense.amount}</h6>
                      <p class="text-muted small">${formatDate(expense.date)}</p>
                  </div>
              `;

              expenseListContainer.appendChild(expenseItem);
          });
      });

      function getCategoryIcon(category) {
          const icons = {
              "shopping": "üõçÔ∏è",
              "food": "üçΩÔ∏è",
              "subscription": "üìÑ",
              "transportation": "üöó",
          };
          return icons[category.toLowerCase()] || "üí∞";
      }

      function capitalizeFirstLetter(string) {
          return string.charAt(0).toUpperCase() + string.slice(1);
      }

      function formatDate(dateString) {
          const date = new Date(dateString);
          return date.toLocaleTimeString([], { day: '2-digit',month:"2-digit" , year: '2-digit' });
      }
  </script>
    <footer class="d-flex justify-content-center w-100 py-3">
      <div class="add-expense">
        <a href="./pages/create-expense.html"
          ><img src="./assets/add.png" alt="Add Expense"
        /></a>
      </div>
    </footer>
  </body>
</html>
